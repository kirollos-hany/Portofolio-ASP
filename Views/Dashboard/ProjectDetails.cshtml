@{
    Layout = "_DashboardLayout";
}
@model ProjectDetailsDashboardViewModel
<!-- Start course-details Area -->
<section class="course-details-area pt-120">
 <div class="container">
<a class="btn btn-danger mr-2 clickable mb-10" is-delete="1" asp-action="delete" asp-controller="projects" asp-route-id="@Model.ChosenProject.Id">Delete</a>
  <div class="row">
   <div class="col-lg-8 left-contents">
     <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
             <ol class="carousel-indicators">
    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
    @for(int i = 1; i <= Model.ChosenProject.ProjectImages.Count; i++)
    {
        <li data-target="#carouselExampleIndicators" data-slide-to="@i"></li>
    }
  </ol>
  <div class="carousel-inner">
    <div class="carousel-item active">
      @if(Model.ChosenProject.Thumbnail.StartsWith("~"))
      {
        var imgSrc = @Url.Content(Model.ChosenProject.Thumbnail);
        <img class="d-block w-100" src="@imgSrc" alt="Project Thumbnail">
      }else
      {
        <img class="d-block w-100" src="~/projects/image/@Model.ChosenProject.Id?isThumbnail=true" alt="Project Thumbnail">
      }
      <i class="mdi mdi-square-edit-outline feather icon-edit m-t-10 f-16 clickable" data-toggle="modal"
                  data-target="#editProjectModal"></i>
    </div>
    @foreach(var projectImage in Model.ChosenProject.ProjectImages)
    {
      if(projectImage.ImagePath.StartsWith("~"))
      {
        var imgSrc = @Url.Content(projectImage.ImagePath);
        <div class="carousel-item">
        <img class="d-block w-100" src="@imgSrc" alt="Project Image">
        <i class="mdi mdi-square-edit-outline feather icon-edit m-t-10 f-16 clickable" data-toggle="modal"
                  data-target="#editProjectModal"></i>
      <a asp-action="deleteimage" asp-controller="projects" asp-route-id="@projectImage.Id" is-delete="1" class="mdi mdi-delete-forever clickable light">
      </a>
      </div>
      }else
      {
      <div class="carousel-item">
        <img class="d-block w-100" src="~/projects/image/@projectImage.Id?isThumbnail=false" alt="Project Image">
        <i class="mdi mdi-square-edit-outline feather icon-edit m-t-10 f-16 clickable" data-toggle="modal"
                  data-target="#editProjectModal"></i>
      <a asp-action="deleteimage" asp-controller="projects" asp-route-id="@projectImage.Id" is-delete="1" class="mdi mdi-delete-forever clickable light">
      </a>
      </div>
      }
    }
      <a class="carousel-control-prev h-75" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next h-75" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
  </div>
</div>
<div class="row padding-sides-9">
  <div id="descriptionContainer" class="active-container col-6 btn-inverse-info btn-lg clickable ">
    <h5 id="descriptionBtn">Description</h5>
  </div>
  <div id="feedbackContainer" class="col-6 btn-inverse-info btn-lg clickable">
    <h5 id="feedbackBtn">Feedback</h5>
  </div>
  <div id="displayDescription" class="white-bg col-12 dark border-dark-2 padding-vertical-10">
    <p id="projectDescriptionP">@Model.ChosenProject.Description</p>
  </div>
  <div id="displayFeedback" class="white-bg col-12 dark border-dark-2 padding-vertical-10">
    @if(Model.ChosenProject.ProjectFeedbacks != null && Model.ChosenProject.ProjectFeedbacks.Count != 0)
    {
      foreach(var feedback in Model.ChosenProject.ProjectFeedbacks)
      {
        <p>@feedback.Feedback</p>
        <span>@feedback.CreatedAt</span>
        <hr>
      }
    }
  </div>
</div>
   </div>
   <div class="col-lg-4 right-contents">
	<a class="primary-btn text-uppercase">@Model.ChosenProject.Title</a>
	<ul>
					@if (@Model.ChosenProject.UsersInProjects.Count != 0)
					{
            var userInProject = Model.ChosenProject.UsersInProjects.Where<UsersInProject>((uip)=>uip.Role.Role == "Team Leader").FirstOrDefault();
							<li>	
								<a class="justify-content-between d-flex clickable" target="_blank" asp-action="profile" asp-controller="home" asp-route-id="@userInProject.User.Id">
									<h5 class="dark">@userInProject.Role.Role</h5>
                  <span class="or dark">@userInProject.User.UserName</span>
								</a>
							</li>
					}
	 <li>
	  <a class="justify-content-between d-flex">
	   <h5 class="dark">Team Members</h5>
	   <span class="or">@Model.ChosenProject.UsersInProjects.Count</span>
	  </a>
	 </li>
	 <li>
	  <a class="justify-content-between d-flex">
	   <h5 class="dark">Technologies & Tools</h5>
	   <span style="margin-left: 20px;" class="or">@Model.ChosenProject.ToolsUsed</span>
	  </a>
	 </li>
	</ul>
   </div>
  </div>
 </div>
</section>
<!-- End course-details Area -->
<!-- Start Featured Work -->
<div id="go" class="featured-work text-center">
		<div class="container">
			<h2 class="light-important">Contributors</h2>
			<ul class="list-unstyled row">
				<li data-class="ALL" class="active col-md">ALL</li>
				@foreach(var userInProject in Model.ChosenProject.UsersInProjects)
				{
					var processedRole = "." + userInProject.Role.Role.Replace(" ", "").ToUpper();
					<li data-class="@processedRole" class="col-md">@userInProject.Role.Role</li>
				}
			</ul>
</div>
 <div class="lol">
  <div class="row shuffle-images">
	  @if(Model.ChosenProject.UsersInProjects != null && Model.ChosenProject.UsersInProjects.Count != 0)
	  {
		  foreach(var userInProject in Model.ChosenProject.UsersInProjects)
		  {
			var processedRole = userInProject.Role.Role.Replace(" ", "").ToUpper();
			<div class="col-md">
				@if(userInProject.User.ImagePath.StartsWith("~"))
				{
					var imgSrc = @Url.Content(userInProject.User.ImagePath);
					<a target = "_blank" class="@processedRole" asp-action="profile" asp-route-id="@userInProject.User.Id" asp-controller="home">
						<img class="img-fluid" src="@imgSrc" alt="contributor img" />
					</a>
				}else
				{
					<a asp-action="profile"  class="@processedRole" asp-controller="home" asp-route-id="@userInProject.User.Id">
						<img class="img-fluid" src="~/user/profileimage/@userInProject.User.Id" alt="Contributor img" />
					</a>
				}
			</div>
		  }
	  }
  </div>
 </div>
</div>
<!-- End Featured Work -->


<!-- Start  -->
<section class="popular-courses-area section-gap courses-page">
 <div class="container">
  <div class="row">
   <a asp-controller="dashboard" asp-action="index" class="primary-btn text-uppercase mx-auto">View other
	projects</a>
  </div>
 </div>

         <!-- Modal HTML Markup -->

<!-- /.modal -->
</section>

<div id="editProjectModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title text-xs-center">Edit Project</h4>
      </div>
    @if (TempData[ResultMessageKey] != null)
      {
        ResultMsgViewModel resultVM = JsonNet.Deserialize<ResultMsgViewModel>(TempData[ResultMessageKey].ToString());
        <div class="modal-header">
          <div class="@resultVM.CssClass">@resultVM.Message</div>
        </div>
      }
      <div class="modal-body">
        <form role="form" asp-action="Edit" asp-controller="Projects" enctype="multipart/form-data" method="post">
        <div class="form-group">
          <label>Title</label>
          <input type="hidden" asp-for="ProjectId" value="@Model.ChosenProject.Id">
          <input type="text" class="form-control" asp-for="Title" value="@Model.ChosenProject.Title">
          <span class="text-danger" asp-validation-for="Title"></span>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea asp-for="Description" class="form-control"></textarea>
          <span class="text-danger" asp-validation-for="Description"></span>
        </div>
        <div class="form-group">
          <label>Tools Used</label>
          <input type="text" class="form-control" asp-for="ToolsUsed" value="@Model.ChosenProject.ToolsUsed">
          <span class="text-danger" asp-validation-for="ToolsUsed"></span>
        </div>
        <div class="form-group">
          <label>Edit Contributors & Roles</label>
          <select class="form-control" multiple asp-for="UsersNRolesIds">
            @if (Model.UserRolesInProject.Count != 0 && Model.ChosenProject.UsersInProjects.Count != 0)
            {
              foreach (var userInProject in Model.ChosenProject.UsersInProjects)
              {
                <option disabled class="light">@userInProject.User.UserName</option>
                <option selected value="@userInProject.Role.Id-@userInProject.User.Id">@userInProject.Role.Role</option>
                @foreach (var userRole in Model.UserRolesInProject)
                {
                  if(userRole.Id == userInProject.Role.Id)
                  {
                    continue;
                  }
                  <option value="@userRole.Id-@userInProject.User.Id">@userRole.Role</option>
                }
                <option class="light" disabled>---------------------</option>
              }
            }
          </select>
          <span class="text-danger" asp-validation-for="UsersNRolesIds"></span>
        </div>
        <div class="form-group">
          <label>Add Contributors & Roles</label>
          <select class="form-control" multiple asp-for="AddUsersNRolesIds">
            @if (Model.UserRolesInProject.Count != 0 && Model.Users.Count != 0)
            {
              foreach (var user in Model.Users)
              {
                <option disabled class="light">@user.UserName</option>
                @foreach (var userRole in Model.UserRolesInProject)
                {
                  <option value="@userRole.Id-@user.Id">@userRole.Role</option>
                }
                <option class="light" disabled>---------------------</option>
              }
            }
          </select>
          <span class="text-danger" asp-validation-for="UsersNRolesIds"></span>
        </div>
        <div class="form-group">
          <label>Edit Thumbnail</label>
          <input type="file" accept ="image/*" asp-for="ProjectThumbnail">
          <span class="text-danger" asp-validation-for="ProjectThumbnail"></span>
        </div>
        <div class="form-group">
          <label>Add Other Images</label>
          <input type="file" accept="image/*" multiple="multiple" asp-for="ProjectImages">
        </div>
        <div class="form-group">
          <label>Project Type</label>
          <select class="form-control" asp-for="ProjectTypeId">
			  <option value="@Model.ChosenProject.Type.Id" selected>@Model.ChosenProject.Type.Type</option>
            @if (Model.ProjectTypes.Count != 0)
            {
              foreach (var pt in Model.ProjectTypes)
              {
                <option value="@pt.Id">@pt.Type</option>
              }
            }
          </select>
          <span asp-validation-for="ProjectTypeId" class="text-danger"></span>
        </div>
        @if (Model.ChosenProject.ProjectLinks.Count != 0)
        {
          @foreach (var projectLink in Model.ChosenProject.ProjectLinks)
          {
            <div class="form-group">
              <label class="control-label">@projectLink.Type.Type</label>
              <div>
                <input type="hidden" value="@projectLink.Id" asp-for="LinksIds"/>
                <input type="text" class="form-control input-lg" asp-for="ProjectLinks" value="@projectLink.Link"/>
              </div>
            </div>
          }
          <span class="text-danger" asp-validation-for="ProjectLinks"></span>
        }
        <button type="submit" class="btn btn-primary mr-2">Submit</button>
        </form>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <script src="~/js/dashboard-project-details.js"></script>
  <!-- /.modal-dialog -->
</div>
  @{
    await Html.RenderPartialAsync("_DeleteBtnPartial");
  }
<!-- End  -->